openapi: 3.1.0
info:
    title: Kanban Backend API
    version: 1.0.0
paths:
    /admin/rebuild:
        post:
            summary: Rebuild SQLite projection from markdown
            operationId: rebuildProjection
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RebuildProjectionOutputBody'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /health:
        get:
            summary: Get health
            operationId: get-health
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HealthOutputBody'
                default:
                    description: Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects:
        get:
            summary: List projects
            operationId: listProjects
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ListProjectsOutputBody'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
        post:
            summary: Create project
            operationId: createProject
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateProjectRequest'
                required: true
            responses:
                "201":
                    description: Created
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Project'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "409":
                    description: Conflict
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects/{project}/cards:
        get:
            summary: List cards
            operationId: listCards
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: include_deleted
                  in: query
                  explode: false
                  schema:
                    type: boolean
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ListCardsOutputBody'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
        post:
            summary: Create card
            operationId: createCard
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateCardRequest'
                required: true
            responses:
                "201":
                    description: Created
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects/{project}/cards/{number}:
        get:
            summary: Get card
            operationId: getCard
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: number
                  in: path
                  required: true
                  schema:
                    type: integer
                    format: int64
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "404":
                    description: Not Found
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
        delete:
            summary: Delete card
            operationId: deleteCard
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: number
                  in: path
                  required: true
                  schema:
                    type: integer
                    format: int64
                - name: hard
                  in: query
                  explode: false
                  schema:
                    type: boolean
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "404":
                    description: Not Found
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects/{project}/cards/{number}/comments:
        post:
            summary: Append card comment
            operationId: commentCard
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: number
                  in: path
                  required: true
                  schema:
                    type: integer
                    format: int64
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/TextBodyRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "404":
                    description: Not Found
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects/{project}/cards/{number}/description:
        patch:
            summary: Append card description entry
            operationId: appendDescription
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: number
                  in: path
                  required: true
                  schema:
                    type: integer
                    format: int64
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/TextBodyRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "404":
                    description: Not Found
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /projects/{project}/cards/{number}/move:
        patch:
            summary: Move card
            operationId: moveCard
            parameters:
                - name: project
                  in: path
                  required: true
                  schema:
                    type: string
                - name: number
                  in: path
                  required: true
                  schema:
                    type: integer
                    format: int64
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/MoveCardRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Card'
                "400":
                    description: Bad Request
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "404":
                    description: Not Found
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "422":
                    description: Unprocessable Entity
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
                "500":
                    description: Internal Server Error
                    content:
                        application/problem+json:
                            schema:
                                $ref: '#/components/schemas/ErrorModel'
    /ws:
        get:
            summary: Websocket event stream
            description: Subscribe to project/card events. Optional project query param filters by project slug.
            operationId: websocketEvents
            responses:
                "101":
                    description: Switching protocols to websocket
components:
    schemas:
        Card:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/Card.json
                    readOnly: true
                column:
                    type: string
                comments:
                    type: array
                    items:
                        $ref: '#/components/schemas/TextEvent'
                created_at:
                    type: string
                    format: date-time
                deleted:
                    type: boolean
                description:
                    type: array
                    items:
                        $ref: '#/components/schemas/TextEvent'
                history:
                    type: array
                    items:
                        $ref: '#/components/schemas/HistoryEvent'
                id:
                    type: string
                number:
                    type: integer
                    format: int64
                project:
                    type: string
                status:
                    type: string
                title:
                    type: string
                updated_at:
                    type: string
                    format: date-time
            required:
                - id
                - project
                - number
                - title
                - status
                - column
                - deleted
                - created_at
                - updated_at
                - description
                - comments
                - history
        CardSummary:
            type: object
            additionalProperties: false
            properties:
                column:
                    type: string
                comments_count:
                    type: integer
                    format: int64
                created_at:
                    type: string
                    format: date-time
                deleted:
                    type: boolean
                history_count:
                    type: integer
                    format: int64
                id:
                    type: string
                number:
                    type: integer
                    format: int64
                project:
                    type: string
                status:
                    type: string
                title:
                    type: string
                updated_at:
                    type: string
                    format: date-time
            required:
                - id
                - project
                - number
                - title
                - status
                - column
                - deleted
                - created_at
                - updated_at
                - comments_count
                - history_count
        CreateCardRequest:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/CreateCardRequest.json
                    readOnly: true
                column:
                    type: string
                description:
                    type: string
                status:
                    type: string
                title:
                    type: string
            required:
                - title
                - status
        CreateProjectRequest:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/CreateProjectRequest.json
                    readOnly: true
                local_path:
                    type: string
                name:
                    type: string
                remote_url:
                    type: string
            required:
                - name
        ErrorDetail:
            type: object
            additionalProperties: false
            properties:
                location:
                    type: string
                    description: Where the error occurred, e.g. 'body.items[3].tags' or 'path.thing-id'
                message:
                    type: string
                    description: Error message text
                value:
                    description: The value at the given location
        ErrorModel:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/ErrorModel.json
                    readOnly: true
                detail:
                    type: string
                    description: A human-readable explanation specific to this occurrence of the problem.
                    examples:
                        - Property foo is required but is missing.
                errors:
                    type: array
                    description: Optional list of individual error details
                    items:
                        $ref: '#/components/schemas/ErrorDetail'
                instance:
                    type: string
                    description: A URI reference that identifies the specific occurrence of the problem.
                    format: uri
                    examples:
                        - https://example.com/error-log/abc123
                status:
                    type: integer
                    description: HTTP status code
                    format: int64
                    examples:
                        - 400
                title:
                    type: string
                    description: A short, human-readable summary of the problem type. This value should not change between occurrences of the error.
                    examples:
                        - Bad Request
                type:
                    type: string
                    description: A URI reference to human-readable documentation for the error.
                    format: uri
                    default: about:blank
                    examples:
                        - https://example.com/errors/example
        HealthOutputBody:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/HealthOutputBody.json
                    readOnly: true
                ok:
                    type: boolean
            required:
                - ok
        HistoryEvent:
            type: object
            additionalProperties: false
            properties:
                details:
                    type: string
                timestamp:
                    type: string
                    format: date-time
                type:
                    type: string
            required:
                - timestamp
                - type
                - details
        ListCardsOutputBody:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/ListCardsOutputBody.json
                    readOnly: true
                cards:
                    type: array
                    items:
                        $ref: '#/components/schemas/CardSummary'
            required:
                - cards
        ListProjectsOutputBody:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/ListProjectsOutputBody.json
                    readOnly: true
                projects:
                    type: array
                    items:
                        $ref: '#/components/schemas/Project'
            required:
                - projects
        MoveCardRequest:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/MoveCardRequest.json
                    readOnly: true
                column:
                    type: string
                status:
                    type: string
            required:
                - status
        Project:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/Project.json
                    readOnly: true
                created_at:
                    type: string
                    format: date-time
                local_path:
                    type: string
                name:
                    type: string
                next_card_seq:
                    type: integer
                    format: int64
                remote_url:
                    type: string
                slug:
                    type: string
                updated_at:
                    type: string
                    format: date-time
            required:
                - name
                - slug
                - created_at
                - updated_at
                - next_card_seq
        RebuildProjectionOutputBody:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/RebuildProjectionOutputBody.json
                    readOnly: true
                cards_rebuilt:
                    type: integer
                    format: int64
                projects_rebuilt:
                    type: integer
                    format: int64
            required:
                - projects_rebuilt
                - cards_rebuilt
        TextBodyRequest:
            type: object
            additionalProperties: false
            properties:
                $schema:
                    type: string
                    description: A URL to the JSON Schema for this object.
                    format: uri
                    examples:
                        - https://example.com/schemas/TextBodyRequest.json
                    readOnly: true
                body:
                    type: string
            required:
                - body
        TextEvent:
            type: object
            additionalProperties: false
            properties:
                body:
                    type: string
                timestamp:
                    type: string
                    format: date-time
            required:
                - timestamp
                - body
